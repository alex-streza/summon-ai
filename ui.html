<div id="mainContainer">
	<h2>Welcome To Summon.AI</h2>
	<p>Time to summon some beautiful images</p>
	<form id="promptContainer">
		<label>
			<span>Prompt</span>
			<textarea
				id="prompt"
				rows="3"
				cols="50"
				placeholder="a photo of a happy corgi puppy sitting and facing forward, studio light, longshot"
				required
			></textarea>
		</label>
		<label>
			<span>DALL-E-2 Token</span>
			<input type="text" id="token" placeholder="Paste secret DALL-E-2 token" required />
			<div id="subtextContainer"><a href="https://openai.com/api/pricing/">Get a DALL-E-2 token</a></div>
		</label>
		<button type="submit" id="generate">Generate image</button>
	</form>
</div>
<script>
	const OPENAI_API_KEY = null;

	const convertDataURIToBinary = (dataURI) =>
		Uint8Array.from(window.atob(dataURI.replace(/^data[^,]+,/, "")), (v) => v.charCodeAt(0));

	document.getElementById("promptContainer").onsubmit = (ev) => {
		ev.preventDefault();

		const textarea = document.getElementById("prompt");
		const token = document.getElementById("token");

		fetch("https://api.openai.com/v1/images/generations", {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
				Authorization: "Bearer " + (OPENAI_API_KEY ?? token.value),
			},
			body: JSON.stringify({
				prompt: textarea.value,
				size: "256x256",
				response_format: "b64_json",
				n: 1,
			}),
		})
			.then((response) => response.json())
			.then(({ data }) => {
				const url = "data:image/png;base64," + data[0].b64_json;
				const image = convertDataURIToBinary(url);

				parent.postMessage(
					{
						pluginMessage: {
							type: "generate",
							data: image,
						},
					},
					"*"
				);
			});
	};

	document.getElementById("cancel").onclick = () => {
		parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
	};
</script>

<style>
	* {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif,
			"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
	}

	h2 {
		font-size: 1.5rem;
		font-weight: 900;
		margin: 0;
		margin-bottom: 8px;
	}

	p {
		margin: 0;
		font-size: 1.125rem;
	}

	#mainContainer {
		padding: 20px 32px;
	}

	#promptContainer {
		margin-top: 40px;
		display: flex;
		flex-direction: column;
		gap: 32px;
	}

	label {
		display: flex;
		flex-direction: column;
		gap: 12px;
	}

	label > span {
		font-size: 1rem;
		font-weight: 600;
	}

	textarea,
	input {
		font-size: 1rem;
		padding: 12px 20px;
		border-radius: 4px;
		border: 1px solid #c1c1c1;
		outline: none;
		resize: none;
	}

	a {
		font-size: 0.875rem;
		color: #000000;
		font-weight: 600;
	}

	textarea:focus,
	input:focus {
		border-color: #63dec7;
	}

	button {
		font-size: 1rem;
		background: #63dec7;
		border-radius: 4px;
		height: 52px;
		padding: 24px 12px;
		width: fit-content;
		display: flex;
		align-items: center;
		justify-content: center;
		font-weight: 600;
		border: none;
		outline: none;
	}

	button:hover {
		cursor: pointer;
		background: #4edac0;
	}

	button:disabled {
		background: #c1c1c1;
	}
</style>
