import {
  MarkGithubIcon,
  SignInIcon,
  SignOutIcon,
  ThreeBarsIcon,
  XIcon,
} from "@primer/octicons-react";
import { signOut, useSession } from "next-auth/react";
import Link from "next/link";
import { useRouter } from "next/router";
import { useCallback, useState } from "react";
import { Button } from "./buttons/Button";

export interface NavigationProps {
  isDark?: boolean;
}

const Navigation = ({ isDark }: NavigationProps) => {
  const { data: session } = useSession();

  const [isOpen, setIsOpen] = useState(false);

  const router = useRouter();

  const currentPath = router.pathname;

  const isLoggedIn = session?.user;

  const handleClick = useCallback(() => {
    if (isLoggedIn) signOut({ callbackUrl: "/" });
    else router.push("/auth/sign-in");
  }, [isLoggedIn]);

  const handleToggleMenu = useCallback(() => setIsOpen((prev) => !prev), []);

  return (
    <div>
      <nav className="flex items-center justify-between p-4 bg-gray-900 rounded-xl bg-opacity-10 backdrop-blur-sm">
        <Link href="/">
          <svg
            height="40"
            viewBox="0 0 201 48"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect width="48" height="48" rx="8" fill="#343434" />
            <g clipPath="url(#clip0_80_49)">
              <path
                fill="white"
                d="M18.2007 19.4237C18.1365 18.6212 17.8355 17.9952 17.2978 17.5458C16.7682 17.0964 15.9616 16.8717 14.8783 16.8717C14.1881 16.8717 13.6223 16.956 13.1809 17.1245C12.7476 17.285 12.4266 17.5057 12.2179 17.7866C12.0093 18.0675 11.9009 18.3885 11.8929 18.7496C11.8768 19.0465 11.929 19.3154 12.0494 19.5561C12.1778 19.7889 12.3784 20.0015 12.6513 20.1941C12.9241 20.3787 13.2732 20.5472 13.6986 20.6997C14.1239 20.8522 14.6295 20.9886 15.2153 21.109L17.2376 21.5424C18.6019 21.8313 19.7696 22.2125 20.7406 22.686C21.7117 23.1594 22.5062 23.7172 23.1241 24.3592C23.742 24.9932 24.1955 25.7074 24.4844 26.5019C24.7813 27.2964 24.9338 28.1631 24.9418 29.1021C24.9338 30.7231 24.5285 32.0954 23.726 33.219C22.9235 34.3425 21.7759 35.1972 20.2832 35.783C18.7986 36.3689 17.013 36.6618 14.9264 36.6618C12.7837 36.6618 10.9138 36.3448 9.31683 35.7108C7.72784 35.0768 6.49196 34.1017 5.60919 32.7856C4.73444 31.4615 4.29306 29.7682 4.28503 27.7057H10.641C10.6811 28.4601 10.8697 29.0941 11.2067 29.6076C11.5438 30.1213 12.0173 30.5105 12.6272 30.7753C13.2451 31.0402 13.9794 31.1726 14.8301 31.1726C15.5444 31.1726 16.1422 31.0843 16.6237 30.9077C17.1052 30.7312 17.4704 30.4864 17.7192 30.1734C17.9679 29.8605 18.0964 29.5033 18.1044 29.1021C18.0964 28.7249 17.9719 28.3959 17.7312 28.115C17.4985 27.8261 17.1133 27.5693 16.5756 27.3446C16.0379 27.1118 15.3116 26.8951 14.3968 26.6945L11.941 26.1649C9.75818 25.6914 8.03679 24.9009 6.77685 23.7934C5.52492 22.6779 4.90297 21.1571 4.911 19.2311C4.90297 17.6662 5.32028 16.2979 6.16292 15.1262C7.01359 13.9465 8.18927 13.0277 9.68998 12.3696C11.1987 11.7115 12.9282 11.3825 14.8783 11.3825C16.8685 11.3825 18.5899 11.7156 20.0425 12.3816C21.495 13.0477 22.6145 13.9867 23.401 15.1985C24.1955 16.4022 24.5967 17.8107 24.6048 19.4237H18.2007Z"
              />
              <g filter="url(#filter0_d_80_49)">
                <path
                  d="M25.7563 36.3729H18.5336L26.6712 11.7196H35.8198L43.9573 36.3729H36.7347L31.3418 18.5088H31.1492L25.7563 36.3729ZM24.408 26.6464H37.9868V31.6541H24.408V26.6464Z"
                  fill="#63DEC7"
                />
              </g>
            </g>
            <path
              className={isDark ? "text-white" : "text-gray-800"}
              d="M70.5341 20.5C70.4886 19.9318 70.2756 19.4886 69.8949 19.1705C69.5199 18.8523 68.9489 18.6932 68.1818 18.6932C67.6932 18.6932 67.2926 18.7528 66.9801 18.8722C66.6733 18.9858 66.446 19.142 66.2983 19.3409C66.1506 19.5398 66.0739 19.767 66.0682 20.0227C66.0568 20.233 66.0938 20.4233 66.179 20.5938C66.2699 20.7585 66.4119 20.9091 66.6051 21.0455C66.7983 21.1761 67.0455 21.2955 67.3466 21.4034C67.6477 21.5114 68.0057 21.608 68.4205 21.6932L69.8523 22C70.8182 22.2045 71.6449 22.4744 72.3324 22.8097C73.0199 23.1449 73.5824 23.5398 74.0199 23.9943C74.4574 24.4432 74.7784 24.9489 74.983 25.5114C75.1932 26.0739 75.3011 26.6875 75.3068 27.3523C75.3011 28.5 75.0142 29.4716 74.446 30.267C73.8778 31.0625 73.0653 31.6676 72.0085 32.0824C70.9574 32.4972 69.6932 32.7045 68.2159 32.7045C66.6989 32.7045 65.375 32.4801 64.2443 32.0312C63.1193 31.5824 62.2443 30.892 61.6193 29.9602C61 29.0227 60.6875 27.8239 60.6818 26.3636H65.1818C65.2102 26.8977 65.3438 27.3466 65.5824 27.7102C65.821 28.0739 66.1563 28.3494 66.5881 28.5369C67.0256 28.7244 67.5455 28.8182 68.1477 28.8182C68.6534 28.8182 69.0767 28.7557 69.4176 28.6307C69.7585 28.5057 70.017 28.3324 70.1932 28.1108C70.3693 27.8892 70.4602 27.6364 70.4659 27.3523C70.4602 27.0852 70.3722 26.8523 70.2017 26.6534C70.0369 26.4489 69.7642 26.267 69.3835 26.108C69.0028 25.9432 68.4886 25.7898 67.8409 25.6477L66.1023 25.2727C64.5568 24.9375 63.3381 24.3778 62.446 23.5938C61.5597 22.804 61.1193 21.7273 61.125 20.3636C61.1193 19.2557 61.4148 18.2869 62.0114 17.4574C62.6136 16.6222 63.446 15.9716 64.5085 15.5057C65.5767 15.0398 66.8011 14.8068 68.1818 14.8068C69.5909 14.8068 70.8097 15.0426 71.8381 15.5142C72.8665 15.9858 73.6591 16.6506 74.2159 17.5085C74.7784 18.3608 75.0625 19.358 75.0682 20.5H70.5341ZM85.6662 26.7727V19.4091H90.3707V32.5H85.9048V30.0114H85.7685C85.4844 30.8466 84.9872 31.5 84.277 31.9716C83.5668 32.4375 82.723 32.6705 81.7457 32.6705C80.831 32.6705 80.0298 32.4602 79.3423 32.0398C78.6605 31.6193 78.1293 31.0398 77.7486 30.3011C77.3736 29.5625 77.1832 28.7159 77.1776 27.7614V19.4091H81.8821V26.7727C81.8878 27.4205 82.0526 27.929 82.3764 28.2983C82.706 28.6676 83.1662 28.8523 83.7571 28.8523C84.1491 28.8523 84.4872 28.7699 84.7713 28.6051C85.0611 28.4347 85.2827 28.196 85.4361 27.8892C85.5952 27.5767 85.6719 27.2045 85.6662 26.7727ZM92.7635 32.5V19.4091H97.2294V21.8977H97.3658C97.6385 21.0795 98.1044 20.4318 98.7635 19.9545C99.4226 19.4773 100.207 19.2386 101.116 19.2386C102.036 19.2386 102.829 19.483 103.494 19.9716C104.158 20.4545 104.559 21.0966 104.695 21.8977H104.832C105.053 21.0966 105.525 20.4545 106.246 19.9716C106.968 19.483 107.815 19.2386 108.786 19.2386C110.042 19.2386 111.059 19.642 111.837 20.4489C112.621 21.2557 113.013 22.3295 113.013 23.6705V32.5H108.309V24.8636C108.309 24.2898 108.164 23.8409 107.874 23.517C107.585 23.1875 107.195 23.0227 106.707 23.0227C106.224 23.0227 105.84 23.1875 105.556 23.517C105.278 23.8409 105.138 24.2898 105.138 24.8636V32.5H100.638V24.8636C100.638 24.2898 100.494 23.8409 100.204 23.517C99.9141 23.1875 99.5249 23.0227 99.0362 23.0227C98.7124 23.0227 98.4339 23.0966 98.201 23.2443C97.968 23.392 97.7862 23.6051 97.6555 23.8835C97.5305 24.1562 97.468 24.483 97.468 24.8636V32.5H92.7635ZM115.334 32.5V19.4091H119.8V21.8977H119.936C120.209 21.0795 120.675 20.4318 121.334 19.9545C121.993 19.4773 122.777 19.2386 123.686 19.2386C124.607 19.2386 125.399 19.483 126.064 19.9716C126.729 20.4545 127.129 21.0966 127.266 21.8977H127.402C127.624 21.0966 128.095 20.4545 128.817 19.9716C129.538 19.483 130.385 19.2386 131.357 19.2386C132.612 19.2386 133.629 19.642 134.408 20.4489C135.192 21.2557 135.584 22.3295 135.584 23.6705V32.5H130.879V24.8636C130.879 24.2898 130.734 23.8409 130.445 23.517C130.155 23.1875 129.766 23.0227 129.277 23.0227C128.794 23.0227 128.411 23.1875 128.126 23.517C127.848 23.8409 127.709 24.2898 127.709 24.8636V32.5H123.209V24.8636C123.209 24.2898 123.064 23.8409 122.774 23.517C122.484 23.1875 122.095 23.0227 121.607 23.0227C121.283 23.0227 121.004 23.0966 120.771 23.2443C120.538 23.392 120.357 23.6051 120.226 23.8835C120.101 24.1562 120.038 24.483 120.038 24.8636V32.5H115.334ZM144.211 32.7386C142.79 32.7386 141.575 32.4574 140.563 31.8949C139.552 31.3267 138.776 30.5369 138.237 29.5256C137.697 28.5085 137.427 27.3295 137.427 25.9886C137.427 24.6477 137.697 23.4716 138.237 22.4602C138.776 21.4432 139.552 20.6534 140.563 20.0909C141.575 19.5227 142.79 19.2386 144.211 19.2386C145.631 19.2386 146.847 19.5227 147.859 20.0909C148.87 20.6534 149.646 21.4432 150.185 22.4602C150.725 23.4716 150.995 24.6477 150.995 25.9886C150.995 27.3295 150.725 28.5085 150.185 29.5256C149.646 30.5369 148.87 31.3267 147.859 31.8949C146.847 32.4574 145.631 32.7386 144.211 32.7386ZM144.245 29.2614C144.643 29.2614 144.987 29.1278 145.276 28.8608C145.566 28.5937 145.79 28.2131 145.95 27.7188C146.109 27.2244 146.188 26.6364 146.188 25.9545C146.188 25.267 146.109 24.679 145.95 24.1903C145.79 23.696 145.566 23.3153 145.276 23.0483C144.987 22.7812 144.643 22.6477 144.245 22.6477C143.825 22.6477 143.464 22.7812 143.163 23.0483C142.862 23.3153 142.631 23.696 142.472 24.1903C142.313 24.679 142.234 25.267 142.234 25.9545C142.234 26.6364 142.313 27.2244 142.472 27.7188C142.631 28.2131 142.862 28.5937 143.163 28.8608C143.464 29.1278 143.825 29.2614 144.245 29.2614ZM157.609 25.1364V32.5H152.904V19.4091H157.37V21.8977H157.506C157.79 21.0682 158.29 20.4176 159.006 19.946C159.728 19.4744 160.569 19.2386 161.529 19.2386C162.455 19.2386 163.259 19.4517 163.941 19.8778C164.629 20.2983 165.16 20.8778 165.535 21.6165C165.915 22.3551 166.103 23.1989 166.097 24.1477V32.5H161.393V25.1364C161.398 24.4886 161.234 23.9801 160.898 23.6108C160.569 23.2415 160.109 23.0568 159.518 23.0568C159.131 23.0568 158.793 23.142 158.504 23.3125C158.219 23.4773 158.001 23.7159 157.847 24.0284C157.694 24.3352 157.614 24.7045 157.609 25.1364ZM170.977 32.7727C170.317 32.7727 169.752 32.5426 169.281 32.0824C168.815 31.6165 168.585 31.0511 168.59 30.3864C168.585 29.7386 168.815 29.1847 169.281 28.7244C169.752 28.2642 170.317 28.0341 170.977 28.0341C171.602 28.0341 172.153 28.2642 172.63 28.7244C173.113 29.1847 173.357 29.7386 173.363 30.3864C173.357 30.8295 173.241 31.233 173.013 31.5966C172.792 31.9545 172.502 32.2415 172.144 32.4574C171.786 32.6676 171.397 32.7727 170.977 32.7727ZM180.386 32.5H175.272L181.033 15.0455H187.511L193.272 32.5H188.158L184.34 19.8523H184.204L180.386 32.5ZM179.431 25.6136H189.045V29.1591H179.431V25.6136ZM199.692 15.0455V32.5H194.953V15.0455H199.692Z"
              fill="currentColor"
            />
            <defs>
              <filter
                id="filter0_d_80_49"
                x="-5.46637"
                y="11.7196"
                width="49.4236"
                height="32.6533"
                filterUnits="userSpaceOnUse"
                colorInterpolationFilters="sRGB"
              >
                <feFlood floodOpacity="0" result="BackgroundImageFix" />
                <feColorMatrix
                  in="SourceAlpha"
                  type="matrix"
                  values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                  result="hardAlpha"
                />
                <feOffset dx="-20" dy="4" />
                <feGaussianBlur stdDeviation="2" />
                <feComposite in2="hardAlpha" operator="out" />
                <feColorMatrix
                  type="matrix"
                  values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0"
                />
                <feBlend
                  mode="normal"
                  in2="BackgroundImageFix"
                  result="effect1_dropShadow_80_49"
                />
                <feBlend
                  mode="normal"
                  in="SourceGraphic"
                  in2="effect1_dropShadow_80_49"
                  result="shape"
                />
              </filter>
              <clipPath id="clip0_80_49">
                <rect
                  width="40"
                  height="25.4237"
                  fill="white"
                  transform="translate(4 11.2881)"
                />
              </clipPath>
            </defs>
          </svg>
        </Link>
        <ul
          className={`hidden items-center gap-5 text-sm md:flex ${
            isDark ? "text-white" : "text-gray-800"
          } uppercase md:mx-auto md:gap-16`}
        >
          <li
            className={currentPath.includes("showcase") ? "text-green-500" : ""}
          >
            <Link href="/showcase">Showcase</Link>
          </li>
          <li>
            <a href="https://www.figma.com/community/plugin/1172891596048319817">
              Figma
            </a>
          </li>
          <li>
            <a
              className="flex items-center gap-1"
              href="https://github.com/alex-streza/summon-ai"
            >
              <span className="peer">Contribute</span>
              <span className="flex scale-90 rounded-full bg-gray-700 py-1.5 px-3 text-xxs text-white transition-transform peer-hover:rotate-12 peer-hover:scale-100 hover:rotate-12 hover:scale-100">
                <MarkGithubIcon />
              </span>
            </a>
          </li>
          <li>
            {isLoggedIn && (
              <Link
                href="/account"
                className={`${
                  currentPath.includes("account") ? "text-green-500" : ""
                } flex items-center gap-1`}
              >
                <span className="peer">Account</span>
                <span className="scale-90 rounded-full bg-gray-700 p-1.5 text-xxs text-white transition-transform peer-hover:rotate-12 peer-hover:scale-100 hover:rotate-12 hover:scale-100">
                  new
                </span>
              </Link>
            )}
          </li>
        </ul>
        <Button className="hidden md:flex" onClick={handleClick}>
          {isLoggedIn ? <SignOutIcon /> : <SignInIcon />}
          {isLoggedIn ? "Sign out" : "Sign in"}
        </Button>
        <button
          onClick={handleToggleMenu}
          className={`md:hidden ${isDark ? "text-white" : ""}`}
        >
          {isOpen ? <XIcon size={28} /> : <ThreeBarsIcon size={28} />}
        </button>
      </nav>
      <aside
        className={`fixed right-0 top-[83px] z-50 ${
          isOpen ? "grid place-content-center opacity-100" : "hidden opacity-0"
        } h-[calc(100vh-46px)] w-screen bg-gray-800 bg-opacity-75 backdrop-blur-sm`}
      >
        <ul
          className={`flex flex-col items-center gap-10 text-center text-lg ${
            isDark ? "text-white" : "text-gray-800"
          } uppercase`}
        >
          <li
            className={currentPath.includes("showcase") ? "text-green-500" : ""}
          >
            <Link href="/showcase">Showcase</Link>
          </li>
          <li>
            <a href="https://www.figma.com/community/plugin/1172891596048319817">
              Figma
            </a>
          </li>
          <li>
            <a
              className="flex items-center gap-1"
              href="https://github.com/alex-streza/summon-ai"
            >
              <span className="peer">Contribute</span>
              <span className="flex scale-90 rounded-full bg-gray-700 py-1.5 px-3 text-xxs text-white transition-transform peer-hover:rotate-12 peer-hover:scale-100 hover:rotate-12 hover:scale-100">
                <MarkGithubIcon />
              </span>
            </a>
          </li>
          <li>
            {isLoggedIn && (
              <Link
                href="/account"
                className={`${
                  currentPath.includes("account") ? "text-green-500" : ""
                } flex items-center gap-1`}
              >
                <span className="peer">Account</span>
                <span className="scale-90 rounded-full bg-gray-700 p-1.5 text-xxs text-white transition-transform peer-hover:rotate-12 peer-hover:scale-100 hover:rotate-12 hover:scale-100">
                  new
                </span>
              </Link>
            )}
          </li>
        </ul>
        <Button className="flex mt-20" onClick={handleClick}>
          {isLoggedIn ? <SignOutIcon /> : <SignInIcon />}
          {isLoggedIn ? "Sign out" : "Sign in"}
        </Button>
      </aside>
    </div>
  );
};

export default Navigation;
